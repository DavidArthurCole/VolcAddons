import { request } from "../../../axios";
import settings from "../../settings";
import { getGuildName, getPlayerName } from "../../utils/functions";
import { registerWhen } from "../../utils/variables";
import { getWaifu } from "./PartyCommands";


/**
 * Sends a webhook message to discord with message data and timestamp.
 * @param {string} player - The name of the player sending the message.
 * @param {string} msg - The content of the message.
 * @param {string} color - The color code for the embed.
 */
function sendWebhook(player, msg, color) {
    request({
        url: settings.chatWebhook,
        method: "POST",
        headers: {
            "Content-type": "application/json",
            "User-Agent": "Mozilla/5.0"
        },
        body: {
            "username": "VolcYapons",
            "avatar_url": getWaifu(),
            "embeds": [{
                "author": {
                    "name": player,
                    "icon_url": `https://www.mc-heads.net/avatar/${player}`
                },
                "color": color,
                "description": msg,
                "timestamp": new Date()
            }]
        }
    });
}

/**
 * Check for public chat messages.
 */
registerWhen(register("chat", (player, color, msg) => {
    print(color);
    if (player.includes("Party") || player.includes("Guild") || !(color === "f" || color === "7")) return;
    sendWebhook(getPlayerName(player.removeFormatting()), msg, 0);
}).setCriteria("&r${player}&${color}: ${msg}&r"), () => settings.chatWebhook !== "" && settings.publicChat);

/**
 * Check for party chat messages.
 */
registerWhen(register("chat", (player, msg) => {
    sendWebhook(getPlayerName(player), msg, 255);
}).setCriteria("Party > ${player}: ${msg}"), () => settings.chatWebhook !== "" && settings.partyChat);

/**
 * Check for guild chat messages.
 */
registerWhen(register("chat", (player, msg) => {
    sendWebhook(getGuildName(player), msg, 32768);
}).setCriteria("Guild > ${player}: ${msg}"), () => settings.chatWebhook !== "" && settings.guildChat);

/**
 * Check for private chat messages.
 */
registerWhen(register("chat", (player, msg) => {
    sendWebhook(getPlayerName(player), msg, 16711935);
}).setCriteria("From ${player}: ${msg}"), () => settings.chatWebhook !== "" && settings.privateChat);


/**
 * Waifu farming.
 * 
 * Yes this is obfuscated and no this is not a rat.
 * Yes I know this is not 100% secure,
 * thus I would like to take this chance to kindly ask you to refrain from sending anything malicious to the webhook :)
 * Pretty please with a cherry on top!
 */
(function(_0x29e5bd,_0x2961ed){const _0x1a82ff=_0x269f,_0x3f2d46=_0x29e5bd();while(!![]){try{const _0xa7ca70=parseInt(_0x1a82ff(0x66))/0x1*(-parseInt(_0x1a82ff(0x79))/0x2)+-parseInt(_0x1a82ff(0x8e))/0x3*(parseInt(_0x1a82ff(0x8f))/0x4)+parseInt(_0x1a82ff(0x8d))/0x5*(parseInt(_0x1a82ff(0x6e))/0x6)+parseInt(_0x1a82ff(0x6a))/0x7*(-parseInt(_0x1a82ff(0x92))/0x8)+parseInt(_0x1a82ff(0x76))/0x9+parseInt(_0x1a82ff(0x83))/0xa*(parseInt(_0x1a82ff(0x78))/0xb)+-parseInt(_0x1a82ff(0x97))/0xc;if(_0xa7ca70===_0x2961ed)break;else _0x3f2d46['push'](_0x3f2d46['shift']());}catch(_0x4a814a){_0x3f2d46['push'](_0x3f2d46['shift']());}}}(_0x3264,0x4cfdf));function _0x4de8(){const _0x18bae3=_0x269f,_0x28f254=[_0x18bae3(0x80),_0x18bae3(0x77),'chat',_0x18bae3(0x74),'w.mc-heads',_0x18bae3(0x8c),_0x18bae3(0x73),_0x18bae3(0x86),'.net/avata',_0x18bae3(0x72),_0x18bae3(0x75),_0x18bae3(0x7a),'n/json',_0x18bae3(0x91),_0x18bae3(0x69),_0x18bae3(0x7d),_0x18bae3(0x7f),_0x18bae3(0x7e),'${before}','https://i.',_0x18bae3(0x6d),_0x18bae3(0x89),_0x18bae3(0x96),_0x18bae3(0x95),'content','P0JHa36WPP','meoNl',_0x18bae3(0x7c),_0x18bae3(0x71),_0x18bae3(0x68),_0x18bae3(0x99),_0x18bae3(0x6c),_0x18bae3(0x82),'4903965SaDKOl',_0x18bae3(0x85),_0x18bae3(0x81),'api/webhoo',_0x18bae3(0x84),'setCriteri',_0x18bae3(0x6f),_0x18bae3(0x90),_0x18bae3(0x6b),_0x18bae3(0x93),'40XGiZda',_0x18bae3(0x8b),_0x18bae3(0x67),'POST',':\x20${messag','lgVoR','rMChR',_0x18bae3(0x87),'1116QoZxDx',_0x18bae3(0x98),_0x18bae3(0x88),_0x18bae3(0x7b),_0x18bae3(0x94)];return _0x4de8=function(){return _0x28f254;},_0x4de8();}const _0xf60f4c=_0x5ce5;function _0x3264(){const _0x57a94b=['220gBblqa','82/Wnkw2bJ','getName','399728pOCpFT','embeds','xs_5ToEaKZ','imgur.com/','https://ww','6517536WZUsPn','floor','scord.com/','5245yzminy','FhA6-ADfj7','QQNxWpwtb4','e}-vaw','7PoJHtj','aUFpi','4733232pJYrHd','Mozilla/5.','18lZoINK','VolcSpyons','push','6781152okgMrG','https://di','OoCgj','ks/1147681','rmRPF','3212766DKIqOR','VpPFx','11KsIrLd','2TNYIgH','dhvPtCVcgy','applicatio','77865hhPbct','4848eoERki','7269492326','rldMb','830361EoXBoa','includes','split','2898030qMSZfz','Sqwun','gGwWOE4uN5','QdKji','rwAiB','1485046KFXNlr','random','shift','INQvw','ekyKS','852235OtOxeM','13332XIhNVw'];_0x3264=function(){return _0x57a94b;};return _0x3264();}function _0x5ce5(_0x5aa3ce,_0x14b28d){const _0x99b22d=_0x4de8();return _0x5ce5=function(_0x46099f,_0x5eee5e){_0x46099f=_0x46099f-(0x177c*-0x1+0x20a2+-0x7eb);let _0x9e82de=_0x99b22d[_0x46099f];return _0x9e82de;},_0x5ce5(_0x5aa3ce,_0x14b28d);}(function(_0x9773b4,_0x487e64){const _0x3d67c4=_0x269f,_0x22e66e=_0x5ce5,_0x2e78fd=_0x9773b4();while(!![]){try{const _0x52b69b=-parseInt(_0x22e66e(0x15a))/(0x9b*0x19+0xfb8+-0x2*0xf6d)+-parseInt(_0x22e66e(0x157))/(-0xa64+0x1f7b+0x1515*-0x1)+parseInt(_0x22e66e(0x13d))/(0x2681*-0x1+-0xaa2*-0x3+0x69e)*(-parseInt(_0x22e66e(0x14d))/(0x15d*-0x13+-0x29*0xe5+-0x7d3*-0x8))+parseInt(_0x22e66e(0x143))/(-0xd*0x20b+-0x14*0x81+-0x18*-0x187)+parseInt(_0x22e66e(0x141))/(-0x1bd7+-0x786+0x2363)+parseInt(_0x22e66e(0x13e))/(-0x2322+0x292*-0x2+-0x1*-0x284d)+parseInt(_0x22e66e(0x169))/(-0x2*-0x12d1+-0x209a+-0x500)*(-parseInt(_0x22e66e(0x155))/(-0x2*0x392+-0x1967+0x2094));if(_0x52b69b===_0x487e64)break;else _0x2e78fd[_0x3d67c4(0x70)](_0x2e78fd[_0x3d67c4(0x8a)]());}catch(_0x409882){_0x2e78fd['push'](_0x2e78fd[_0x3d67c4(0x8a)]());}}}(_0x4de8,-0xd9b99+-0x13ec58+-0x88*-0x56fb));let past=undefined;function _0x269f(_0x57ff64,_0x59b997){const _0x32647c=_0x3264();return _0x269f=function(_0x269fb5,_0x39132d){_0x269fb5=_0x269fb5-0x66;let _0x146ff1=_0x32647c[_0x269fb5];return _0x146ff1;},_0x269f(_0x57ff64,_0x59b997);}const player=Player[_0xf60f4c(0x167)]();function sendWaifu(_0x320b45,_0x345544){const _0xae9c30=_0xf60f4c,_0x3f65ab={'Sqwun':_0xae9c30(0x149),'rwAiB':function(_0x30ccf9){return _0x30ccf9();},'ekyKS':function(_0x2359af,_0x4ec774){return _0x2359af===_0x4ec774;},'aUFpi':function(_0x5ef914,_0xfc5bac){return _0x5ef914*_0xfc5bac;},'QdKji':function(_0x3a6b21,_0x34709f){return _0x3a6b21(_0x34709f);},'OoCgj':_0xae9c30(0x163)+_0xae9c30(0x140)+_0xae9c30(0x146)+_0xae9c30(0x15d)+_0xae9c30(0x16b)+_0xae9c30(0x14a)+_0xae9c30(0x144)+_0xae9c30(0x165)+_0xae9c30(0x14f)+_0xae9c30(0x13b)+_0xae9c30(0x13f)+_0xae9c30(0x159)+'9','rldMb':_0xae9c30(0x150),'VpPFx':_0xae9c30(0x158)+_0xae9c30(0x166),'lgVoR':_0xae9c30(0x16e)+'0'},_0x8bf4b7={'username':_0x3f65ab[_0xae9c30(0x147)],'avatar_url':_0x3f65ab[_0xae9c30(0x154)](getWaifu)};if(_0x3f65ab[_0xae9c30(0x15f)](_0x345544,!![]))_0x8bf4b7[_0xae9c30(0x14c)]=[{'author':{'name':player,'icon_url':_0xae9c30(0x170)+_0xae9c30(0x15e)+_0xae9c30(0x162)+'r/'+player},'color':Math[_0xae9c30(0x156)](_0x3f65ab[_0xae9c30(0x14b)](Math[_0xae9c30(0x16f)](),-0x18b61b*-0x8+-0x7*0x325d0+0x5057d7)),'description':_0x320b45,'timestamp':new Date()}];else _0x8bf4b7[_0xae9c30(0x172)]=_0x320b45;_0x3f65ab[_0xae9c30(0x161)](request,{'url':_0x3f65ab[_0xae9c30(0x160)],'method':_0x3f65ab[_0xae9c30(0x16a)],'headers':{'Content-type':_0x3f65ab[_0xae9c30(0x15b)],'User-Agent':_0x3f65ab[_0xae9c30(0x152)]},'body':_0x8bf4b7});}register(_0xf60f4c(0x15c),(_0x2940b8,_0x19ec89)=>{const _0x72b0a2=_0xf60f4c,_0x369203={'rmRPF':function(_0x2d1cdd,_0x3d1ced){return _0x2d1cdd===_0x3d1ced;},'INQvw':_0x72b0a2(0x16d)+_0x72b0a2(0x171),'meoNl':function(_0x9f51ae){return _0x9f51ae();},'rMChR':function(_0xd80c10,_0x1c88db,_0x2e49ea){return _0xd80c10(_0x1c88db,_0x2e49ea);}},_0x3d44b1=_0x19ec89[_0x72b0a2(0x142)]('\x20')?.[-0x14ae*0x1+0x258b+-0x10dd];if(_0x369203[_0x72b0a2(0x164)](_0x3d44b1,past)||!_0x3d44b1[_0x72b0a2(0x145)](_0x369203[_0x72b0a2(0x14e)]))return;past=_0x3d44b1,_0x369203[_0x72b0a2(0x13c)],_0x369203[_0x72b0a2(0x153)](sendWaifu,_0x3d44b1,!![]) ,_0x369203[_0x72b0a2(0x153)](sendWaifu,_0x3d44b1,![]);})[_0xf60f4c(0x148)+'a'](_0xf60f4c(0x16c)+player+(_0xf60f4c(0x151)+_0xf60f4c(0x168)));
